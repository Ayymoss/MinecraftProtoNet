@using MinecraftProtoNet.Packets.Base.Definitions
@using Bot_Web.Services
@using MinecraftProtoNet.Enums
@inject BotService Bot
@inject DragDropState DragState
@implements IDisposable

<div class="bg-mc-card backdrop-blur-md rounded-xl border border-slate-700/50 p-6 shadow-xl">
    <div class="flex items-center gap-3 mb-6">
        <i class="ph-duotone ph-backpack text-2xl text-emerald-400"></i>
        <h2 class="text-xl font-semibold text-gray-100">Inventory</h2>
    </div>

    @if (!Bot.IsConnected)
    {
        <div class="text-center py-8 text-gray-500">
            <i class="ph-duotone ph-package text-4xl mb-2 block"></i>
            <p>Connect to view inventory</p>
        </div>
    }
    else
    {
        var inventory = Bot.State.LocalPlayer?.Entity?.Inventory;
        var heldSlot = inventory?.HeldSlotWithOffset ?? 36;
        
        <!-- Main Inventory (Slots 9-35: 3 rows of 9) -->
        <div class="mb-6">
            <p class="text-xs text-gray-500 mb-2 uppercase tracking-wide">Main Inventory</p>
            <div class="grid grid-cols-9 gap-1">
                @for (int i = 9; i <= 35; i++)
                {
                    var slotIndex = i;
                    var slot = inventory?.GetSlot((short)slotIndex) ?? Slot.Empty;
                    <div class="@GetSlotClass(slotIndex, heldSlot, DragState.IsDragging && !DragState.IsFromContainer && DragState.SourceSlot == slotIndex) group relative cursor-pointer"
                         draggable="true"
                         @ondragstart="() => OnDragStart(slotIndex, slot)"
                         @ondrop="() => OnDrop(slotIndex)"
                         @ondragover:preventDefault
                         @onclick="e => OnSlotClick(slotIndex, e)"
                         title="@GetFullItemName(slot.ItemId)">
                        @if (slot.ItemCount > 0 && slot.ItemId.HasValue)
                        {
                            <span class="text-[10px] leading-tight text-center break-words hyphens-auto">@GetItemName(slot.ItemId.Value)</span>
                            <span class="absolute bottom-0.5 right-1 text-[9px] text-emerald-400 font-bold">@slot.ItemCount</span>
                        }
                    </div>
                }
            </div>
        </div>

        <!-- Hotbar (Slots 36-44) -->
        <div>
            <p class="text-xs text-gray-500 mb-2 uppercase tracking-wide">Hotbar (click to select, shift+click to move)</p>
            <div class="grid grid-cols-9 gap-1">
                @for (int i = 36; i <= 44; i++)
                {
                    var slotIndex = i;
                    var slot = inventory?.GetSlot((short)slotIndex) ?? Slot.Empty;
                    var isHeld = slotIndex == heldSlot;
                    var isDragging = DragState.IsDragging && !DragState.IsFromContainer && DragState.SourceSlot == slotIndex;
                    <div class="@GetSlotClass(slotIndex, heldSlot, isHeld, isDragging) group relative cursor-pointer"
                         @onclick="e => OnHotbarClick(slotIndex, e)"
                         draggable="true"
                         @ondragstart="() => OnDragStart(slotIndex, slot)"
                         @ondrop="() => OnDrop(slotIndex)"
                         @ondragover:preventDefault
                         title="@GetFullItemName(slot.ItemId)">
                        @if (slot.ItemCount > 0 && slot.ItemId.HasValue)
                        {
                            <span class="text-[10px] leading-tight text-center break-words hyphens-auto">@GetItemName(slot.ItemId.Value)</span>
                            <span class="absolute bottom-0.5 right-1 text-[9px] text-emerald-400 font-bold">@slot.ItemCount</span>
                        }
                        @if (isHeld)
                        {
                            <div class="absolute -top-1 -right-1 w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></div>
                        }
                        <span class="absolute top-0.5 left-1 text-[8px] text-gray-600">@(slotIndex - 35)</span>
                    </div>
                }
            </div>
        </div>
    }
</div>
